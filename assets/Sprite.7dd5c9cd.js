import{S as b,A as y,d as E,W as L,j as k,x as u,H as h,h as B,D as G,i as A,v as _,w,G as P}from"./three.module.00e15d00.js";import{O as R}from"./OrbitControls.7e68ed9b.js";import{d as W,q as D,a2 as I,o as q,f as F,_ as H}from"./index.817c0e39.js";const j={id:"sprite"},O=W({__name:"Sprite",setup(z){let l,i,o,d,g;D(()=>{f()}),I(()=>{d.removeEventListener("change",s),window.cancelAnimationFrame(g),v()});function f(){const e=document.querySelector("#sprite");if(!e)return;const n=e.clientWidth,t=e.clientHeight;i=new b;const r=new y(16777215,.6);i.add(r),M(),S(),C(),l=new E(60,n/t,1,1e4),l.position.set(300,10,300),l.lookAt(i.position),i.add(l),o=new L({antialias:!0}),o.setSize(n,t),o.setPixelRatio(window.devicePixelRatio),o.setClearColor(12178431,1),e.appendChild(o.domElement),d=new R(l,o.domElement),d.addEventListener("change",s),s()}function M(){let e=new k(1e3,1e3);const n=location.origin+"/img/grasslight-big.jpg";new u().load(n,t=>{t.wrapS=h,t.wrapT=h,t.repeat.set(10,10);const r=new B({color:7829248,map:t,side:G}),a=new A(e,r);a.rotateX(Math.PI/2),i.add(a),s()})}function S(){const e=location.origin+"/img/tree-02.png";new u().load(e,n=>{for(let t=0;t<100;t++){let r=new _({map:n}),a=new w(r);i.add(a),a.scale.set(100,100,1);const p=Math.random()-.5,m=Math.random()-.5;a.position.set(1e3*p,45,1e3*m)}s()})}let c=new P;function C(){const e=location.origin+"/img/sprite.png";new u().load(e,n=>{for(let t=0;t<400;t++){const r=new _({map:n}),a=new w(r);c.add(a),a.scale.set(8,10,1);let p=Math.random()-.5,m=Math.random()-.5,x=Math.abs(Math.random()-.5);a.position.set(1e3*p,400*x,1e3*m)}i.add(c),s()})}function s(){c&&c.children.length>0&&c.children.forEach(e=>{e.position.y-=1,e.position.y<=0&&(e.position.y=Math.random()*400)}),o.render(i,l),g=requestAnimationFrame(s)}function v(){var n;console.log("\u9500\u6BC1\u6A21\u578B");const e=document.getElementById("vertex-structure");try{if(e){i.clear(),o.dispose(),o.forceContextLoss();const t=o.domElement.getContext("webgl");t&&((n=t.getExtension("WEBGL_lose_context"))==null||n.loseContext()),e.innerHTML="",console.log("\u9500\u6BC1\u6210\u529F")}}catch(t){console.log(t),console.log("\u9500\u6BC1\u5931\u8D25")}}return(e,n)=>(q(),F("div",j))}});const $=H(O,[["__scopeId","data-v-304d61cf"]]);export{$ as default};
